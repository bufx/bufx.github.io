<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Jenkins Pipeline使用 - buubiu的技术分享主页</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="buubiu的技术分享主页"><meta name="msapplication-TileImage" content="/img/common/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="buubiu的技术分享主页"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="什么是Jenkins的流水线Jenkins Pipeline（或简称为带有大写“P”的“Pipeline”）是一套插件，支持将持续交付管道实现和集成到 Jenkins 中。 一个持续交付（CD）管道是一直到你的用户和客户的过程正从版本控制软件的自动化表达。对您的软件（在源代码控制中提交）的每一次更改在发布之前都经历了一个复杂的过程。此过程涉及以可靠且可重复的方式构建软件，以及通过多个测试和部署阶段"><meta property="og:type" content="blog"><meta property="og:title" content="Jenkins Pipeline使用"><meta property="og:url" content="https://blog.buubiu.com/Jenkins-Pipeline%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="buubiu的技术分享主页"><meta property="og:description" content="什么是Jenkins的流水线Jenkins Pipeline（或简称为带有大写“P”的“Pipeline”）是一套插件，支持将持续交付管道实现和集成到 Jenkins 中。 一个持续交付（CD）管道是一直到你的用户和客户的过程正从版本控制软件的自动化表达。对您的软件（在源代码控制中提交）的每一次更改在发布之前都经历了一个复杂的过程。此过程涉及以可靠且可重复的方式构建软件，以及通过多个测试和部署阶段"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.buubiu.com/img/article/WVZeR41639988647902.jpg"><meta property="article:published_time" content="2021-12-20T08:18:58.000Z"><meta property="article:modified_time" content="2024-02-02T02:18:02.477Z"><meta property="article:author" content="buubiu"><meta property="article:tag" content="Jenkins"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://blog.buubiu.com/img/article/WVZeR41639988647902.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.buubiu.com/Jenkins-Pipeline%E4%BD%BF%E7%94%A8/"},"headline":"Jenkins Pipeline使用","image":["https://blog.buubiu.com/img/article/WVZeR41639988647902.jpg"],"datePublished":"2021-12-20T08:18:58.000Z","dateModified":"2024-02-02T02:18:02.477Z","author":{"@type":"Person","name":"buubiu"},"publisher":{"@type":"Organization","name":"buubiu的技术分享主页","logo":{"@type":"ImageObject","url":"https://blog.buubiu.com/img/common/favicon.ico"}},"description":"什么是Jenkins的流水线Jenkins Pipeline（或简称为带有大写“P”的“Pipeline”）是一套插件，支持将持续交付管道实现和集成到 Jenkins 中。 一个持续交付（CD）管道是一直到你的用户和客户的过程正从版本控制软件的自动化表达。对您的软件（在源代码控制中提交）的每一次更改在发布之前都经历了一个复杂的过程。此过程涉及以可靠且可重复的方式构建软件，以及通过多个测试和部署阶段"}</script><link rel="canonical" href="https://blog.buubiu.com/Jenkins-Pipeline%E4%BD%BF%E7%94%A8/"><link rel="icon" href="/img/common/favicon.ico"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?3c3ec636275df73c9383cb68964ee62a";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/common/favicon.ico" alt="buubiu的技术分享主页" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/bufx"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/../img/article/WVZeR41639988647902.jpg" alt="Jenkins Pipeline使用"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-20T08:18:58.000Z" title="2021/12/20 16:18:58">2021-12-20</time>发表</span><span class="level-item"><time dateTime="2024-02-02T02:18:02.477Z" title="2024/2/2 10:18:02">2024-02-02</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Jenkins/">Jenkins</a></span><span class="level-item">44 分钟读完 (大约6588个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Jenkins Pipeline使用</h1><div class="content"><h2 id="什么是Jenkins的流水线"><a href="#什么是Jenkins的流水线" class="headerlink" title="什么是Jenkins的流水线"></a>什么是Jenkins的流水线</h2><p>Jenkins Pipeline（或简称为带有大写“P”的“Pipeline”）是一套插件，支持将<em>持续交付管道</em>实现和集成到 Jenkins 中。</p>
<p>一个<em>持续交付（CD）管道</em>是一直到你的用户和客户的过程正从版本控制软件的自动化表达。对您的软件（在源代码控制中提交）的每一次更改在发布之前都经历了一个复杂的过程。此过程涉及以可靠且可重复的方式构建软件，以及通过多个测试和部署阶段推进构建的软件（称为“构建”）。</p>
<p>Pipeline 提供了一组可扩展的工具，用于通过<a target="_blank" rel="noopener" href="https://www.jenkins.io/doc/book/pipeline/syntax">Pipeline 域特定语言 (DSL) 语法</a>对从简单到复杂的交付管道“作为代码”进行建模 </p>
<span id="more"></span>

<h2 id="创建Pipeline项目的三种方式"><a href="#创建Pipeline项目的三种方式" class="headerlink" title="创建Pipeline项目的三种方式"></a>创建Pipeline项目的三种方式</h2><h3 id="Pipeline的定义"><a href="#Pipeline的定义" class="headerlink" title="Pipeline的定义"></a>Pipeline的定义</h3><p>对Jenkins 流水线的定义被写在一个文本文件中 (称为 <a target="_blank" rel="noopener" href="https://www.jenkins.io/zh/doc/book/pipeline/jenkinsfile"><code>Jenkinsfile</code></a>)，该文件可以被提交到项目的源代码的控制仓库。这是”流水线即代码”的基础; 将CD 流水线作为应用程序的一部分，像其他代码一样进行版本化和审查。</p>
<p><code>Jenkinsfile</code> 能使用两种语法进行编写 - 声明式和脚本化。</p>
<p>声明式和脚本化的流水线从根本上是不同的。 声明式流水线相较于脚本化的流水线：</p>
<ul>
<li>声明式流水线提供更丰富的语法特性,</li>
<li>声明式流水线是为了使编写和读取流水线代码更容易而设计的。</li>
<li>脚本化流水线是用<a target="_blank" rel="noopener" href="http://groovy-lang.org/semantics.html">Groovy 语法</a>编写的</li>
</ul>
<p>不过，许多写入 的单个语法组件（或“步骤”） <code>Jenkinsfile</code>对于声明式管道和脚本式管道都是通用的</p>
<h3 id="通过Blue-Ocean创建"><a href="#通过Blue-Ocean创建" class="headerlink" title="通过Blue Ocean创建"></a>通过Blue Ocean创建</h3><p>在 Blue Ocean 中设置一个流水线项目后，Blue Ocean UI 会帮你编写流水线的 <code>Jenkinsfile</code> 文件并提交到源代码管理系统。</p>
<h3 id="通过经典UI创建（推荐）"><a href="#通过经典UI创建（推荐）" class="headerlink" title="通过经典UI创建（推荐）"></a>通过经典UI创建（推荐）</h3><p>使用经典 UI 创建的 <code>Jenkinsfile</code> 由 Jenkins 自己保存（在 Jenkins 的主目录下）。</p>
<ol>
<li><p>登录成功后，从Jenkins 主页（即 Jenkins 经典 UI 的工作台），点击左上的 <strong>新建Item</strong>。</p>
<p><img src="/../img/article/8l92zi1639990600658.png"></p>
</li>
<li><p>输入名称，点击 流水线，并确认</p>
<blockquote>
<p><strong>注意：</strong> Jenkins 使用此项目名称在磁盘上创建目录。建议避免在项目名称中使用空格，因为这样做可能会发现脚本中未正确处理目录路径中的空格的错误。</p>
</blockquote>
<p><img src="/../img/article/VUTtZW1639990674671.png"></p>
<ol start="3">
<li><p>点击页面顶部 <strong>流水线</strong>选项卡，确保 <strong>定义</strong>字段是 <strong>Pipeline script</strong>选项，并写入流水线代码，保存</p>
<p> <img src="/../img/article/ZM6Knz1639990884792.png"></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Stage 1&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello world!&#x27;</span> </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>agent</code> 指 Jenkins 为整个流水线分配一个执行器（在 Jenkins 环境中的任何可用代理&#x2F;节点上）和工作区。</li>
<li><code>echo</code> 写一个简单的字符串到控制台输出。</li>
<li><code>node</code> 与上面的 <code>agent</code> 做了同样的事情。</li>
</ul>
</li>
</ol>
</li>
<li><p>在该页面, 点击左侧的 <strong>立即构建</strong> 运行流水线</p>
<p><img src="/../img/article/tQV3bk1639991265057.png"></p>
</li>
<li><p>在左侧的 <strong>Build History</strong> 下面，点击 <strong>#1</strong> 来访问这个特定流水线运行的详细信息。</p>
</li>
<li><p>点击 <strong>Console Output</strong> 来查看流水线运行的全部输出。下面的输出显示你的流水线已成功运行。</p>
<p><img src="/../img/article/lVsPb11639991313946.png"></p>
</li>
</ol>
<h3 id="通过SCM-源代码管理系统-创建"><a href="#通过SCM-源代码管理系统-创建" class="headerlink" title="通过SCM(源代码管理系统)创建"></a>通过SCM(源代码管理系统)创建</h3><p>复杂的流水线如果 <a href="#%E9%80%9A%E8%BF%87%E7%BB%8F%E5%85%B8UI%E5%88%9B%E5%BB%BA">通过经典UI创建</a> ，很麻烦和复杂</p>
<p>为简化操作，流水线的 <code>Jenkinsfile</code> 可以在文本编辑器或集成开发环境（IDE）中进行编写并提交到源码管理系统 （可选择性地与需要 Jenkins 构建的应用程序代码放在一起）。然后 Jenkins 从源代码管理系统中检出 <code>Jenkinsfile</code> 文件作为流水线项目构建过程的一部分并接着执行你的流水线。</p>
<p>操作步骤：</p>
<ol>
<li>按照  <a href="#%E9%80%9A%E8%BF%87%E7%BB%8F%E5%85%B8UI%E5%88%9B%E5%BB%BA">通过经典UI创建</a> 上面的步骤定义你的流水线直到第3步（在流水线配置页面访问<strong>流水线</strong>部分）</li>
<li>从 <strong>定义</strong> 字段选择 <strong>Pipeline script from SCM</strong> 选项。</li>
<li>从 <strong>SCM</strong> 字段，选择包含 <code>Jenkinsfile</code> 文件的仓库的源代码管理系统的类型。</li>
<li>填充对应仓库的源代码管理系统的字段。</li>
<li>在 <strong>脚本路径</strong> 字段，指定你的 <code>Jenkinsfile</code> 文件的位置（和名称）。这个位置是 Jenkins 检出&#x2F;克隆包括 <code>Jenkinsfile</code> 文件的仓库的位置，它应该与仓库的文件结构匹配。该字段的默认值采取名称为 “Jenkinsfile” 的 <code>Jenkinsfile</code> 文件并位于仓库的根路径。</li>
</ol>
<p><img src="/../img/article/3ZHBZw1639992344407.png"></p>
<h2 id="创建Pipeline"><a href="#创建Pipeline" class="headerlink" title="创建Pipeline"></a>创建Pipeline</h2><p>对于目前最新版本的 Jenkins 来说，存在两种语法格式的 Pipeline：<code>脚本式 Pipeline（Scripted Pipeline）</code>和<code>声明式 Pipeline(Declarative Pipeline)</code>。</p>
<h3 id="脚本式-Pipeline"><a href="#脚本式-Pipeline" class="headerlink" title="脚本式 Pipeline"></a>脚本式 Pipeline</h3><p>脚本式 Pipeline 是早期编写 Pipelien 的语法，开发人员通过编写自己的 Groovy 脚本来定义 Pipeline，虽然这为我们提供了很强的灵活性，但需要开发者有较好的 Groovy 编程经验。</p>
<h4 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">    stage(<span class="string">&quot;CodeStyle Check&quot;</span>) &#123;</span><br><span class="line">        echo <span class="string">&quot;Checking...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&quot;Build&quot;</span>) &#123;</span><br><span class="line">        echo <span class="string">&quot;Building...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&quot;Test&quot;</span>) &#123;</span><br><span class="line">        echo <span class="string">&quot;Testing...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&quot;Deploy&quot;</span>) &#123;</span><br><span class="line">        echo <span class="string">&quot;Deploying...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol>
<li>最外层有<code>node&#123;&#125;</code>包裹</li>
<li>可直接使用<code>groovy</code>语句</li>
</ol>
<h3 id="声明式-Pipeline（重点核心）"><a href="#声明式-Pipeline（重点核心）" class="headerlink" title="声明式 Pipeline（重点核心）"></a>声明式 Pipeline（重点核心）</h3><p>声明式 Pipeline 是在 Pipeline 2.5 版本中新引入的语法格式，相对于 脚本式 Pipeline 来说，声明式 Pipelien 提供了更加简洁和灵活的语法，新增了更丰富的功能，在大大降低了 Pipeline 编写难度的同时，又不失其灵活性。无论你之前是否了解过 Pipeline，声明式 Pipeline 都是你以后在编写 Pipeline 道路上的的首选方案。</p>
<h4 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&quot;CodeStyle Check&quot;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&quot;Checking...&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&quot;Build&quot;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&quot;Building&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&quot;Test&quot;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&quot;Testing&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&quot;Deploy&quot;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&quot;Deploying&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>pipeline</code> 用于定义 Pipeline 块，所有有关 Pipeline 定义的部分必须全部被定义在该语句块内，除了 Groovy 定义的类，方法，变量等。</li>
<li><code>agent</code> 指定要执行 Pipeline 的 Jenkins 节点。</li>
<li><code>stages</code> 用来包括所有的 <code>stage</code>。</li>
<li><code>stage</code> 用来包括具体所要执行的操作。</li>
<li><code>steps</code> 用来包括要执行的指令。</li>
<li><code>echo</code> 打印字符串。</li>
</ul>
<h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><ol>
<li>最外层必须由<code>pipline&#123; //do something &#125;</code>来进行包裹</li>
<li>不需要分号作为分隔符，每个语句必须在一行内</li>
<li>不能直接使用<code>groovy</code>语句（例如循环判断等），需要被script {}包裹</li>
</ol>
<h2 id="Pipeline-语法"><a href="#Pipeline-语法" class="headerlink" title="Pipeline 语法"></a>Pipeline 语法</h2><p>主要是介绍 声明式 Pipeline 中的语法</p>
<h3 id="pipeline"><a href="#pipeline" class="headerlink" title="pipeline"></a>pipeline</h3><p>应用于全局最外层，表明该脚本为声明式pipeline</p>
<hr>
<h3 id="agent"><a href="#agent" class="headerlink" title="agent"></a>agent</h3><p>当我们要执行某个 Pipeline 时，必须指定执行该 Pipelien 的 Jenkins 节点，只有指定了运行节点的 Pipeline 才可以被执行。指定执行节点是通过 <code>agent</code> 来定义的。<code>agent</code> 必须被定义在 <code>pipeline&#123;&#125;</code> 块的最顶端，我们可以称之为全局 agent，用来为整个 Pipeline 指定一个要执行的节点。可选的，也可以在某个 <code>stage</code> 块中定义 <code>agent</code>，表明为当前 stage 指定一个执行节点，我们会在讲解 <code>stage</code> 时在具体介绍。</p>
<h4 id="参数列表"><a href="#参数列表" class="headerlink" title="参数列表"></a>参数列表</h4><p><strong><code>any</code></strong></p>
<p>表明 Pipeline 可以在任意一个 Jenkins 节点中运行，包括 master 节点。当使用该参数时，Jenkins 会在当前空闲的节点中随意选择一个节点来运行 Pipeline。</p>
<p>示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong><code>label</code></strong><br>通过 Jenkins 节点的 Label 属性选择节点。</p>
<p>示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        label <span class="string">&#x27;Linux&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该示例表明将在所有 Label 为 Linux 的节点中随机选择一个空闲的节点来执行 Pipeline。</p>
<blockquote>
<p><em>注意：如果指定了一个不存在的 Label，Jenkins 会像处理离线节点那样，Job将一直等待节点上线，而并不会报出任何异常。</em></p>
</blockquote>
<p><strong><code>node</code></strong><br><code>node</code> 是在 <code>label</code> 参数的基础上，添加了一些附加的选项。它是一个语句块，语句块中可以定义以下参数：</p>
<ul>
<li><code>label</code>：必选参数，与 agent 的 label 参数功能一样，通过 Jenkins 节点的 Label 属性来选择适当的节点</li>
<li><code>customWorkspace</code>：可选参数，指定当前节点上执行 Pipeline 或是 Stage（在 stage 中设置了 agent）时的目录。默认情况下，当运行 Pipeline 时，Jenkins 会在工作节点机器上的默认工作目录（通过节点配置页面的 <code>Remote root directory</code> 选项指定）下创建一个与所运行 Job 同名的子目录作为 Pipeline 的执行目录。<code>customWorkspace</code> 选项可以让我们手动选择一个自定义。其值可以是一个绝对路径，也可以是一个以该节点默认的工作目录为根路径的相对路径。</li>
</ul>
<p>示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">      node &#123;</span><br><span class="line">          label <span class="string">&#x27;Linux&#x27;</span></span><br><span class="line">          customWorkspace <span class="string">&#x27;/tmp/Jenkins&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个示例中，除了我们额外使用绝对路径指定了 Pipeline 的工作目录为 <code>/tmp/Jenkins</code> 之外，其功能与使用 <code>label</code> 的示例功能完全相同。</p>
<p><strong><code>none</code></strong><br>只有 Pipeline 最顶端的 <code>agent</code> 可以指定为 <code>none</code> 参数，该参数表明不为当前整体 Pipeline 分配任何节点，相应地，必须在每个 <code>stage</code> 块中单独配置一个 Jenkins 节点，这样不同的 stage 可以运行在不同的 Jenkins 节点中。</p>
<p>示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">//没有为当前 Pipeline 分配任何执行节点</span></span><br><span class="line">  agent none</span><br><span class="line">  stages &#123;</span><br><span class="line">    <span class="comment">//指定 stage1 可以运行在任何一个节点中</span></span><br><span class="line">    stage(<span class="string">&quot;stage1&quot;</span>) &#123;</span><br><span class="line">      agent any</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//指定 stage2 只能运行在 Label 是 Linux 的节点上</span></span><br><span class="line">    stage(<span class="string">&quot;stage2&quot;</span>) &#123;</span><br><span class="line">      agent &#123;</span><br><span class="line">        label <span class="string">&quot;Linux&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="stages"><a href="#stages" class="headerlink" title="stages"></a>stages</h3><p><code>stages</code> 是一个用来包含一个或多个 <code>stage</code> 指令的序列块，它无需任何参数。每个 Pipeline 必须有且只能有一个 <code>stages</code> 块，而且每个 <code>stages</code> 中至少需要包含一个 <code>stage</code> 指令。</p>
<p>而 <code>stage</code> 是用来包裹那些真正执行某些操作的指令的。每个 stage 应当包含用于去完成某个 比如构建代码，执行测试用例，部署到生产环境中去等，而这些步骤一般都被封装在各自的 <code>stage</code> 中。一个 <code>stages</code> 块中必须至少包含一个 <code>stage</code> 指令。在整个 Pipeline 中，应当有且仅有一个 <code>stages</code> 块。<code>stages</code> 在使用时不接受任何参数。</p>
<hr>
<h3 id="stage"><a href="#stage" class="headerlink" title="stage"></a>stage</h3><p>在编写一个 Pipeline 时，我们应当按照不同的阶段或是不同的功能，将 Pipeline 拆分成不同的阶段，比如在整个 CD 流程中，一般都至少包括 打包代码、运行自动化测试脚本以及部署等流程。<code>stage</code> 就是用来封装这些流程的，我们应当将这些流程分别定义在各自的 <code>stage</code> 中，当运行 Pipeline 时，Jenkins 会按照定义时的顺序依次执行这些流程。同时，最终生成的可视化页面也是按照 <code>stage</code> 为单位显示的。</p>
<p><code>stage</code> 必须被包含在 <code>stages</code> 中，并且至少包含一个。而在每个 <code>stage</code> 中，必须包含其只能包含一个 <code>steps</code> 来执行具体的指令，或是一个 <code>parallel</code> 指令来定义需要并行执行的 <code>stage</code>，以及一些可选的如 <code>agent</code>、<code>environment</code>、<code>options</code>、<code>tool</code> 等其他指令。</p>
<h4 id="参数列表-1"><a href="#参数列表-1" class="headerlink" title="参数列表"></a>参数列表</h4><p><code>stage</code> 接收一个字符串参数，用来给当前 stage 命名。</p>
<p>示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent &#123;</span><br><span class="line">    label <span class="string">&#x27;Linux&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    <span class="comment">//定义一个名为 build 的 stage</span></span><br><span class="line">    stage(<span class="string">&quot;build&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">//在该 stage 内部定义 agent，指明运行当前 stage 时所在的 Jenkins 节点</span></span><br><span class="line">      agent &#123;</span><br><span class="line">        label <span class="string">&#x27;Linux2&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//定义一个 step，这是该 stage 真正执行操作的地方。在这个示例中，通过 sh step 在节点中执行 mvn clean install 命令</span></span><br><span class="line">      steps &#123;</span><br><span class="line">        sh <span class="string">&#x27;mvn clean install&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义一个名为 test 的 stage，该 stage 会运行在 Pipeline 中指定的节点中</span></span><br><span class="line">    stage(<span class="string">&quot;test&quot;</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh <span class="string">&quot;mvn test&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="steps"><a href="#steps" class="headerlink" title="steps"></a>steps</h3><p><code>steps</code> 被定义在 <code>stage</code> 中，每个 <code>stage</code> 必须包含且只能包含一个 <code>steps</code>， 用于调用 Jenkins 中的特定指令，比如在前面的例子所中使用的 <code>sh</code> 指令。</p>
<p><code>steps</code> 中除了可以调用 Jenkins 中定义的指令外，还支持 <code>script</code> 指令，在 <code>script</code> 中，我们可以定义并执行脚本式 Pipeline。</p>
<p>示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">//调用 echo 指令来输出 “Hello World” 字符串</span></span><br><span class="line">        echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">        <span class="comment">//9-14行：通过 script 指令执行 Groovy 脚本</span></span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="keyword">def</span> browsers = [<span class="string">&#x27;chrome&#x27;</span>, <span class="string">&#x27;firefox&#x27;</span>]</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; browsers.size(); ++i) &#123;</span><br><span class="line">            echo <span class="string">&quot;Testing the $&#123;browsers[i]&#125; browser&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="environment"><a href="#environment" class="headerlink" title="environment"></a>environment</h3><p><code>environment</code> 指令可以帮助我们定义环境变量，当在指定的 Jenkins 节点中在执行 stage 中的指令时，定义的环境变量会被添加到节点机器的系统环境变量中去。该指令既可以被定义在 <code>pipeline</code> 最外层中来定义环境变量，这样定义的环境变量对所有 <code>stage</code> 都有效，也可有定义在某个特定的 <code>stage</code> 中，这样定义的环境变量仅仅会应用到当前 stage 执行时所在的节点。</p>
<h4 id="credentials-方法"><a href="#credentials-方法" class="headerlink" title="credentials 方法"></a>credentials 方法</h4><p><code>credentials</code> 是 <code>environment</code> 指令提供了一个附加的 helper 方法，通过将我们在 Jenkins 中定义的 credentials 时指定的 ID 作为参数传递给该方法，可以获取到该 credential 的值，并将该值赋值给指定的环境变量。使用 <code>credentials</code> 方法获取到的 credential 的值仍然是加密过的，因此用户不必担心敏感信息的泄漏问题。<br>如果我们不想将这些 credentials 以环境变量的形式获取，还可以使用 Jenkins 还提供的 <a target="_blank" rel="noopener" href="https://jenkins.io/doc/pipeline/steps/credentials-binding/">withCredentials</a> 方法。</p>
<p>示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  <span class="comment">//4-6 行，在 Pipeline 最外层定义了一个环境变量 CC，这个环境变量可以被该 Pipeline 中的所有 stage 所引用</span></span><br><span class="line">  environment &#123;</span><br><span class="line">    CC = <span class="string">&#x27;clang&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">//10-12行，在 stage 中定义的环境变量 AN_ACCESS_KEY，并将系统中预定义好的 ID 为 my-prefined-secret-text 的 credential 的值。该环境变量仅对当前 stage 有效</span></span><br><span class="line">      environment &#123;</span><br><span class="line">        AN_ACCESS_KEY = credentials(<span class="string">&#x27;my-prefined-secret-text&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">//通过执行系统的 printenv 命令里获取所有系统中所有环境变量，可以在输出中同时看到我们上面定义的 CC 和 AN_ACCESS_KEY 两个环境变量，并且 AN_ACCESS_KEY 的值是以 **** 的形式展现出来的</span></span><br><span class="line">        sh <span class="string">&#x27;printenv&#x27;</span></span><br><span class="line">        <span class="comment">//通过 Jenkins 中的 env 系统变量来获取指定的环境变量</span></span><br><span class="line">        echo <span class="string">&quot;$&#123;env.AN_ACCESS_KEY&#125;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><p><code>options</code> 指令可以让我们为当前的 Pipeline 或某个特定的 stage 设置一些附加选项。</p>
<p>如果该指令出现在 <code>pipeline</code> 块的最外层，则这些选项对整个 <code>Pipeline</code> 生效；</p>
<p>如果该指令出现在某个 <code>stage</code> 内，则这些选项设置仅对当前的 <code>stage</code> 生效。</p>
<p><code>options</code> 指令中可用的选项，一部分来自于 Jenkins 自身定义好的，一部分来自于某些插件。并且对整体 Pipeline 范围来说可用的选项和 stage 范围可用的选项也不尽相同，下面让分别介绍一下在 Pipeline 级别中和 stage 级别中一些比较常用的选项。</p>
<h4 id="Pipeline-中的可用选项"><a href="#Pipeline-中的可用选项" class="headerlink" title="Pipeline 中的可用选项"></a>Pipeline 中的可用选项</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  options &#123;</span><br><span class="line">    <span class="comment">//表示只保留最近执行的 5 个 Job 的日志和归档信息</span></span><br><span class="line">    buildDiscarder(logRotator(<span class="attr">numToKeepStr:</span> <span class="string">&#x27;5&#x27;</span>))</span><br><span class="line">    <span class="comment">//关闭 Pipeline 并行执行的能力</span></span><br><span class="line">    disableConcurrentBuilds()</span><br><span class="line">    <span class="comment">//当某个 stage 执行结果状态变为 UNSTABLE 时，将跳过余下的所有 stage</span></span><br><span class="line">    skipStagesAfterUnstable()</span><br><span class="line">    <span class="comment">//指定该 Pipeline 最多可执行 1 小时</span></span><br><span class="line">    timeout(<span class="attr">time:</span> <span class="number">1</span>, <span class="attr">unit:</span> <span class="string">&#x27;HOURS&#x27;</span>)</span><br><span class="line">    <span class="comment">//当 Pipeline 执行失败后，指定尝试重新执行该 Pipeline 的次数</span></span><br><span class="line">    retry(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">//当日志信息打印到 Jenkins Job 的控制台输出页面时，同时打印出日志的时间戳信息</span></span><br><span class="line">    timestamps()</span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        ......</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong><code>buildDiscarder</code></strong><br>每当 Jenkins Job 被执行一次，都会产生一些日志文件，或是一些由 Job 生成的归档文件，当 Job 被执行的次数越多，生成的日志和归档文件就越多，数以千计的日志文件和归档文件不但会占用大量的系统磁盘资源，还会影响到 Jenkins 性能。因此定期清理这些无用的日志和归档文件非常重要。<code>buildDiscarder</code> 选项可以让我们选择保留该 Pipeline 最近执行的多少个 Job 的日志信息，超过这个数量的 Job 日志信息和归档文件将被自动清除。</p>
<p>如：<code>options &#123; buildDiscarder(logRotator(numToKeepStr: &#39;5&#39;)) &#125;</code>，表示只保留最近执行的 5 个 Job 的日志和归档信息。</p>
<p>我们还可以直接在 Jenkins Job 的配置页面中，通过配置 <code>Discard old builds</code> 来达到同样的目的。</p>
<p><strong><code>disableConcurrentBuilds</code></strong><br>默认情况下，Pipeline 支持并行运行，即同一个 Pipeline 可以同时被执行多次（前提是执行 Pipeline 的 agent 设置正确）。当有些时候，我们并不希望 Pipeline 被并行执行，<code>disableConcurrentBuilds</code> 方法可以帮助我们关闭 Pipeline 并行执行的能力，如: <code>options &#123; disableConcurrentBuilds() &#125;</code></p>
<p><strong><code>skipStagesAfterUnstable</code></strong><br>如果设定了 <code>skipStagesAfterUnstable</code> 选项，则当某个 stage 执行结果状态变为 UNSTABLE 时，将跳过余下的所有 stage。如：<code>options &#123; skipStagesAfterUnstable() &#125;</code>。</p>
<p><strong><code>timeout</code></strong><br><code>timeout</code> 选项可用于设置 Pipeline 的最大执行时间，当超过指定时间后，Pipeline 将被自动终止。如：<code>options &#123; timeout(time: 1, unit: &#39;HOURS&#39;) &#125;</code> 指定该 Pipeline 最多可执行 1 小时。</p>
<p><strong><code>retry</code></strong><br>就像该参数名字的含义一样，当 Pipeline 执行失败后，我们可以通过 <code>retry</code> 参数指定尝试重新执行该 Pipeline 的次数，当尝试过指定次数后仍然失败，则 Pipeline 状态设置为失败并退出执行。如：<code>options &#123; retry(3) &#125;</code>。</p>
<p><strong><code>timestamps</code></strong><br>当日志信息打印到 Jenkins Job 的控制台输出页面时，同时打印出日志的时间戳信息。如：<code>options &#123; timestamps() &#125;</code>。</p>
<h4 id="stage-中的可用的选项"><a href="#stage-中的可用的选项" class="headerlink" title="stage 中的可用的选项"></a>stage 中的可用的选项</h4><p>这些选项在 stage 中的使用方式与在 Pipeline 中的使用方式一样，只是在 stage 中定义的选项仅对当前的 stage 有效。</p>
<p><strong><code>timeout</code></strong><br>设置当前 stage 的最大执行时间。</p>
<p><strong><code>retry</code></strong><br>设置当前 stage 执行失败后可以自动尝试重新执行的次数。</p>
<p><strong><code>timestamps</code></strong><br>仅为当前 stage 中的日志输出设置时间戳信息。</p>
<h3 id="parameters"><a href="#parameters" class="headerlink" title="parameters"></a>parameters</h3><p>虽然在创建 Jenkins job 时可以在 Job 配置页面指定执行 Job 时所需的参数，Pipeline 额外还提供了 <code>parameters</code> 指令，用于声明执行 Pipeline 时所需要的参数列表。<code>parameters</code> 指令只能被包含在 <code>pipeline</code> 块的最外层，并且在整个 Pipeline 块中只能定义一个 <code>parameters</code> 指令。</p>
<p>在 <code>parameters</code> 指令中支持调用两个方法：<code>string()</code> 和 <code>booleanParam()</code>， 分别用于定义一个字符串类型的参数和一个布尔值类型的参数，每个方法都可以接收一下参数：</p>
<h4 id="参数列表-2"><a href="#参数列表-2" class="headerlink" title="参数列表"></a>参数列表</h4><p><strong><code>name</code></strong><br>必选参数，指定参数的名字。</p>
<p><strong><code>defaultValue</code></strong><br>指定参数的默认值，该参数为可选参数，对于字符串类型的参数来说，如果没有指定该参数，默认值为 <code>null</code>；对于布尔值类型的参数来说，如果没有指定改制，默认是为 <code>false</code>。</p>
<p><strong><code>description</code></strong><br>可选参数，为该参数添加描述信息，方法其他开发人员参考。</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  <span class="comment">//6-9行中，我们使用 parameters 指令定义了两个参数：</span></span><br><span class="line">  <span class="comment">//- 参数名为 PERSON 的字符串类型的，该参数默认值为 Mr Jenkins。</span></span><br><span class="line">  <span class="comment">//- 参数名为 DEBUG_BUILD 的布尔值类型参数，该参数默认为 true。</span></span><br><span class="line">  parameters &#123;</span><br><span class="line">    string(<span class="attr">name:</span> <span class="string">&#x27;PERSON&#x27;</span>, <span class="attr">defaultValue:</span> <span class="string">&#x27;Mr Jenkins&#x27;</span>, <span class="attr">description:</span> <span class="string">&#x27;Who should I say hello to?&#x27;</span>)</span><br><span class="line">    booleanParam(<span class="attr">name:</span> <span class="string">&#x27;DEBUG_BUILD&#x27;</span>, <span class="attr">defaultValue:</span> <span class="literal">true</span>, <span class="attr">description:</span> <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">//通过 Jenkins 内置的 params 变量来获取这两个参数的值</span></span><br><span class="line">        echo <span class="string">&quot;Hello $&#123;params.PERSON&#125;&quot;</span></span><br><span class="line">        echo <span class="string">&quot;$&#123;params.DEBUG_BUILD&#125;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="when"><a href="#when" class="headerlink" title="when"></a>when</h3><p><code>when</code> 指令可以帮助我们编写条件式 stage，即只有某些条件符合时，才会执行指定的 <code>stage</code> 指令，它必须定义在 <code>stage</code> 中。Jenkins 内置了许多条件表达式，让我们简单介绍一下常见的表达式。</p>
<h4 id="常见的表达式"><a href="#常见的表达式" class="headerlink" title="常见的表达式"></a>常见的表达式</h4><p><strong><code>allOf</code></strong><br>至少包含一个表达式，并且当所有的表达式都为真时，才会执行该 stage。</p>
<p><strong><code>anyOf</code></strong><br>至少包含一个表达式，并且只要有一个条件为真，就会执行该 stage。</p>
<p><strong><code>not</code></strong><br>只能包含一个表达式，当该表达式为假时，就会执行该 stage。</p>
<p><strong><code>environment</code></strong><br>如果存在指定的环境变量，并且其值等于给定的值，则执行该 stage。</p>
<p><strong><code>expression</code></strong><br>当给定的 Groovy 脚本返回真时，则执行该 stage。</p>
<p><strong><code>branch</code></strong><br>如果当前使用的分支名与指定的分支名相同，则执行该 stage。注意，只有在多分支的 Pipeline 中才可以使用该选项。</p>
<h4 id="beforeAgent-行为"><a href="#beforeAgent-行为" class="headerlink" title="beforeAgent 行为"></a><code>beforeAgent</code> 行为</h4><p>默认情况下，当执行某个带有 <code>when</code> 指令的 stage 时，Jenkins 首先会进入到当前 stage 要执行的节点服务器中，然后在判断 <code>when</code> 指令中指定的条件。</p>
<p>如果指定 <code>beforeAgent</code> 为 <code>true</code>，则在进入到节点之前就开始进行判断，只有条件符合后才会进入到节点中执行该 stage。</p>
<h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example Deploy&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">//定义 when 指令，该指令中共包含 3 个条件，when 指令默认使用 allOf，因此，只有定义的 3 个条件全部为真时，当前 stage Example Deploy 才会被执行</span></span><br><span class="line">      when &#123;</span><br><span class="line">        <span class="comment">//指定先对 when 中的条件进行判断，只有所有条件符合后，才会进入到某个节点中执行 steps 操作</span></span><br><span class="line">        beforeAgent <span class="literal">true</span></span><br><span class="line">        <span class="comment">//当前所操作的分支名应当为 production</span></span><br><span class="line">        branch <span class="string">&#x27;production&#x27;</span></span><br><span class="line">        <span class="comment">//通过 expression 指定的该表达式返回应当返回真</span></span><br><span class="line">        expression &#123; BRANCH_NAME ==~ <span class="regexp">/(production|staging)/</span> &#125;</span><br><span class="line">        <span class="comment">//14-17行，在 anyOf 块中定义了两个表达式：执行的节点系统中存在环境变量 DEPLOY_TO，并且该值必须是 production 或 staging 中的一个值</span></span><br><span class="line">        anyOf &#123;</span><br><span class="line">          environment <span class="attr">name:</span> <span class="string">&#x27;DEPLOY_TO&#x27;</span>, <span class="attr">value:</span> <span class="string">&#x27;production&#x27;</span></span><br><span class="line">          environment <span class="attr">name:</span> <span class="string">&#x27;DEPLOY_TO&#x27;</span>, <span class="attr">value:</span> <span class="string">&#x27;staging&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">&#x27;Deploying&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Parallel"><a href="#Parallel" class="headerlink" title="Parallel"></a>Parallel</h3><p>在 Pipeline 中，默认同时只能执行一个 <code>stage</code> 块，但有些时候某些 stage 之间没有互相依赖关系，我们通常希望可以并行执行这些互相没有任何依赖的 stage，来加速整个 Pipeline 的构建速度。我们可以通过 Pipeline 提供的 <code>parallel</code> 指令来实现，该指令必须被包含在 <code>stage</code> 块中，<code>parallel</code> 中不能在嵌套其他的 <code>parallel</code>。注意，在定义了 <code>parallel</code> 的 stage 中，不能够在使用任何 <code>agent</code> 或 <code>tool</code> 等指令，如果有必须，需要在 <code>parallel</code> 中的每个 stage 中进行各自的定义。</p>
<p>同时，我们还可以指定，当并行执行的多个 stage 中，只要有任意一个 stage 执行失败，就可以终止所有其他并行执行的 stage，这通过设置 <code>failFast true</code> 来实现。</p>
<h4 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Non-Parallel Stage&#x27;</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">&#x27;This stage will be executed first.&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&#x27;Parallel Stage&#x27;</span>) &#123;</span><br><span class="line">      when &#123;</span><br><span class="line">        branch <span class="string">&#x27;master&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//指定了 failFast true，表明 parallel 中定义的 Branch A stage 和 Branch B stage 中的任意一个执行失败，另一个则会马上停止</span></span><br><span class="line">      failFast <span class="literal">true</span></span><br><span class="line">      <span class="comment">//定义了 parralel，并在其内部定义了两个可以同时并行执行的 stage：Branch A 和 Branch B</span></span><br><span class="line">      parallel &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Branch A&#x27;</span>) &#123;</span><br><span class="line">          <span class="comment">//19-21行，为 ‘Branch A’ stage 指定了要执行的节点</span></span><br><span class="line">          agent &#123;</span><br><span class="line">            label <span class="string">&quot;for-branch-a&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">          steps &#123;</span><br><span class="line">            echo <span class="string">&quot;On Branch A&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Branch B&#x27;</span>) &#123;</span><br><span class="line">          agent &#123;</span><br><span class="line">            label <span class="string">&quot;for-branch-b&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">          steps &#123;</span><br><span class="line">            echo <span class="string">&quot;On Branch B&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="tools"><a href="#tools" class="headerlink" title="tools"></a>tools</h3><p>用于引用配置好的工具，需要提前在 <strong>系统管理-&gt;全局工具配置</strong>里面配置过</p>
<h4 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  tools &#123;</span><br><span class="line">    maven <span class="string">&#x27;apache-maven-3.0.1&#x27;</span> </span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh <span class="string">&#x27;mvn --version&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><p><code>input</code>指令允许暂时中断pipeline执行，等待用户输入，根据用户输入进行下一步动作</p>
<h4 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">      input &#123;</span><br><span class="line">        message <span class="string">&quot;Should we continue?&quot;</span></span><br><span class="line">        ok <span class="string">&quot;Yes, we should.&quot;</span></span><br><span class="line">        submitter <span class="string">&quot;alice,bob&quot;</span></span><br><span class="line">        parameters &#123;</span><br><span class="line">          string(<span class="attr">name:</span> <span class="string">&#x27;PERSON&#x27;</span>, <span class="attr">defaultValue:</span> <span class="string">&#x27;Mr Jenkins&#x27;</span>, <span class="attr">description:</span> <span class="string">&#x27;Who should I say hello to?&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">&quot;Hello, $&#123;PERSON&#125;, nice to meet you.&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="post"><a href="#post" class="headerlink" title="post"></a>post</h3><p>执行构建后的操作，根据构建结果来执行对应的操作，作用在pipeline结束后或者stage结束后。</p>
<h4 id="参数列表-3"><a href="#参数列表-3" class="headerlink" title="参数列表"></a>参数列表</h4><ul>
<li><p><code>always</code></p>
<p>无论pipeline或stage的完成状态如何，都允许在 <code>post</code> 部分运行该步骤。</p>
</li>
<li><p><code>changed</code></p>
<p>只有当前pipeline或stage的完成状态与它之前的运行不同时，才允许在 <code>post</code> 部分运行该步骤。</p>
</li>
<li><p><code>failure</code></p>
<p>只有当前pipeline或stage的完成状态为”failure”，才允许在 <code>post</code> 部分运行该步骤, 通常web UI是红色。</p>
</li>
<li><p><code>success</code></p>
<p>只有当前pipeline或stage的完成状态为”success”，才允许在 <code>post</code> 部分运行该步骤, 通常web UI是蓝色或绿色。</p>
</li>
<li><p><code>unstable</code></p>
<p>只有当前pipeline或stage的完成状态为”unstable”，才允许在 <code>post</code> 部分运行该步骤, 通常由于测试失败,代码违规等造成。通常web UI是黄色。</p>
</li>
<li><p><code>aborted</code></p>
<p>只有当前pipeline或stage的完成状态为”aborted”，才允许在 <code>post</code> 部分运行该步骤, 通常由于pipeline被手动的aborted。通常web UI是灰色。</p>
</li>
</ul>
<h4 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline&#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages&#123;</span><br><span class="line">    stage(<span class="string">&quot;first stage&quot;</span>)&#123;</span><br><span class="line">      steps(<span class="string">&quot;first steps&quot;</span>)&#123;</span><br><span class="line">        echo <span class="string">&quot;this is first step&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  post&#123;</span><br><span class="line">    always&#123;</span><br><span class="line">      echo <span class="string">&quot;this is ending...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">myname</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> get() &#123;</span><br><span class="line">    print(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> get() &#123;</span><br><span class="line">  print(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String name = <span class="string">&#x27;zzl&#x27;</span></span><br><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">  agent &#123;</span><br><span class="line">    label <span class="string">&#x27;Linux&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  environment &#123;</span><br><span class="line">    GIT_COMMITTER_NAME = <span class="string">&#x27;jenkins&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  options &#123;</span><br><span class="line">    timeout(<span class="number">6</span>, HOURS)</span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Build&#x27;</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        sh <span class="string">&#x27;mvn clean install&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&#x27;Archive&#x27;</span>) &#123;</span><br><span class="line">      when &#123;</span><br><span class="line">        branch <span class="string">&#x27;*/master&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        archive <span class="string">&#x27;*/target/**/*&#x27;</span></span><br><span class="line">        junit <span class="string">&#x27;*/target/surefire-reports/*.xml&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  post &#123;</span><br><span class="line">    always &#123;</span><br><span class="line">      deleteDir()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>Jenkins Pipeline使用</p><p><a href="https://blog.buubiu.com/Jenkins-Pipeline使用/">https://blog.buubiu.com/Jenkins-Pipeline使用/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>buubiu</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-12-20</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2024-02-02</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Jenkins/">Jenkins</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/Jenkins%E5%88%9B%E5%BB%BA%E5%A4%9A%E5%88%86%E6%94%AFpipeline/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Jenkins创建多分支pipeline</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Jenkins%E7%9A%84%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%AE%89%E8%A3%85/"><span class="level-item">Jenkins的介绍与安装</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#什么是Jenkins的流水线"><span class="level-left"><span class="level-item">1</span><span class="level-item">什么是Jenkins的流水线</span></span></a></li><li><a class="level is-mobile" href="#创建Pipeline项目的三种方式"><span class="level-left"><span class="level-item">2</span><span class="level-item">创建Pipeline项目的三种方式</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Pipeline的定义"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Pipeline的定义</span></span></a></li><li><a class="level is-mobile" href="#通过Blue-Ocean创建"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">通过Blue Ocean创建</span></span></a></li><li><a class="level is-mobile" href="#通过经典UI创建（推荐）"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">通过经典UI创建（推荐）</span></span></a></li><li><a class="level is-mobile" href="#通过SCM-源代码管理系统-创建"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">通过SCM(源代码管理系统)创建</span></span></a></li></ul></li><li><a class="level is-mobile" href="#创建Pipeline"><span class="level-left"><span class="level-item">3</span><span class="level-item">创建Pipeline</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#脚本式-Pipeline"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">脚本式 Pipeline</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#格式"><span class="level-left"><span class="level-item">3.1.1</span><span class="level-item">格式</span></span></a></li><li><a class="level is-mobile" href="#特点"><span class="level-left"><span class="level-item">3.1.2</span><span class="level-item">特点</span></span></a></li></ul></li><li><a class="level is-mobile" href="#声明式-Pipeline（重点核心）"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">声明式 Pipeline（重点核心）</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#格式-1"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">格式</span></span></a></li><li><a class="level is-mobile" href="#特点-1"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">特点</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Pipeline-语法"><span class="level-left"><span class="level-item">4</span><span class="level-item">Pipeline 语法</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#pipeline"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">pipeline</span></span></a></li><li><a class="level is-mobile" href="#agent"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">agent</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#参数列表"><span class="level-left"><span class="level-item">4.2.1</span><span class="level-item">参数列表</span></span></a></li></ul></li><li><a class="level is-mobile" href="#stages"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">stages</span></span></a></li><li><a class="level is-mobile" href="#stage"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">stage</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#参数列表-1"><span class="level-left"><span class="level-item">4.4.1</span><span class="level-item">参数列表</span></span></a></li></ul></li><li><a class="level is-mobile" href="#steps"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">steps</span></span></a></li><li><a class="level is-mobile" href="#environment"><span class="level-left"><span class="level-item">4.6</span><span class="level-item">environment</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#credentials-方法"><span class="level-left"><span class="level-item">4.6.1</span><span class="level-item">credentials 方法</span></span></a></li></ul></li><li><a class="level is-mobile" href="#options"><span class="level-left"><span class="level-item">4.7</span><span class="level-item">options</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Pipeline-中的可用选项"><span class="level-left"><span class="level-item">4.7.1</span><span class="level-item">Pipeline 中的可用选项</span></span></a></li><li><a class="level is-mobile" href="#stage-中的可用的选项"><span class="level-left"><span class="level-item">4.7.2</span><span class="level-item">stage 中的可用的选项</span></span></a></li></ul></li><li><a class="level is-mobile" href="#parameters"><span class="level-left"><span class="level-item">4.8</span><span class="level-item">parameters</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#参数列表-2"><span class="level-left"><span class="level-item">4.8.1</span><span class="level-item">参数列表</span></span></a></li><li><a class="level is-mobile" href="#示例"><span class="level-left"><span class="level-item">4.8.2</span><span class="level-item">示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#when"><span class="level-left"><span class="level-item">4.9</span><span class="level-item">when</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#常见的表达式"><span class="level-left"><span class="level-item">4.9.1</span><span class="level-item">常见的表达式</span></span></a></li><li><a class="level is-mobile" href="#beforeAgent-行为"><span class="level-left"><span class="level-item">4.9.2</span><span class="level-item">beforeAgent 行为</span></span></a></li><li><a class="level is-mobile" href="#示例-1"><span class="level-left"><span class="level-item">4.9.3</span><span class="level-item">示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Parallel"><span class="level-left"><span class="level-item">4.10</span><span class="level-item">Parallel</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#示例-2"><span class="level-left"><span class="level-item">4.10.1</span><span class="level-item">示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#tools"><span class="level-left"><span class="level-item">4.11</span><span class="level-item">tools</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#示例-3"><span class="level-left"><span class="level-item">4.11.1</span><span class="level-item">示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#input"><span class="level-left"><span class="level-item">4.12</span><span class="level-item">input</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#示例-4"><span class="level-left"><span class="level-item">4.12.1</span><span class="level-item">示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#post"><span class="level-left"><span class="level-item">4.13</span><span class="level-item">post</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#参数列表-3"><span class="level-left"><span class="level-item">4.13.1</span><span class="level-item">参数列表</span></span></a></li><li><a class="level is-mobile" href="#示例-5"><span class="level-left"><span class="level-item">4.13.2</span><span class="level-item">示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#完整示例"><span class="level-left"><span class="level-item">4.14</span><span class="level-item">完整示例</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/common/favicon.ico" alt="buubiu的技术分享主页" height="28"></a><p class="is-size-7"><span>&copy; 2024 buubiu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><span>  <img src="/img/common/foot-ga.png">  <a title="苏公网安备 32032102000187号" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=32032102000187" target="_blank" rel="noopener">苏公网安备 32032102000187号</a></span><span>  <img src="/img/common/foot-icp.png">  <a title="苏ICP备2021016911号-1" href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">苏ICP备2021016911号-1</a></span><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/bufx"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>